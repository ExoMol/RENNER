      SUBROUTINE SOME  ( VALSYM , VALASY ,
     1                   SMAT   , HMAT   , NOFSRO , NOFSCO ,
     1                   NDIMRO , NDIMCO , V2MP11 , V2MP12 ,
     1                   IRODIM , 
     1                   ITAURO , ITAUCO , NP1ROW , NP1COL ,
     1                   INTSYM , INTASY , ISTOFF , JSTOFF ,
     1                   NOBAL  , NOBAR  , NOPERS , NZERSY ,
     1                   NZERAS , FACTJ  , NELEC  , KP1, KNDSYM ,
     1                   KNDASY )
      IMPLICIT REAL*8 (A-H,O-Z)
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      EPSP,EPSPP,EPSPPP,CR,SR,CSE,SNE,
     2      CRE,SRE,CORO
C
      REAL*8 AMASS(3,10)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(128) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1, V2MP11, V2MP12,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(9,10)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER LENINT,IOSC1,IOSC3,I,J,IR,JL
      REAL*8 G,GC1,GC3,GC1113,GC3133,GC1133,GC3113
      REAL*8 SMAT(NOBAL,NOBAR,NOPERS),VALSYM(INTSYM),VALASY(INTASY),
     1       HMAT(IRODIM,IRODIM)
      REAL*8  CONCOR,CONFC1,CONG11,CONG33,CONG13,CORHOE
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     1               F11,F33,F13,F111,F333,F113,F133,
     1               F1111,F3333,F1113,F1333,F1133,
     2               F1,F1A1,F2A1,F3A1,F4A1,F3,F1A3,F2A3,F3A3,F4A3,
     3               F1A11,F2A11,F3A11,F1A33,F2A33,F3A33,
     4               F1A13,F2A13,F3A13,
     5               F1A111,F2A111,F1A333,F2A333,
     6               F1A113,F2A113,F1A133,F2A133,
     7               FA1111,FA3333,FA1113,
     8               FA1333,FA1133, R12RF1, R32RF1, R12RF2, R32RF2,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
      COMMON /RENTEL/G1,G3,G11,G33,G13,G111,G333,G113,G133,
     1               G1111,G3333,G1113,G1333,G1133,
     2               GA1,GA2,GA3,GA4,GA5,GA6,GA7,GA8,
     2               G1A1,G2A1,G3A1,G4A1,G1A3,G2A3,G3A3,G4A3,
     3               G1A11,G2A11,G3A11,G1A33,G2A33,G3A33,
     4               G1A13,G2A13,G3A13,
     5               G1A111,G2A111,G1A333,G2A333,
     6               G1A113,G2A113,G1A133,G2A133,
     7               GA1111,GA3333,GA1113,
     8               GA1333,GA1133,
     1               HA1,HA2,HA3,HA4,HA5,HA6,HA7,HA8,
     2               H1A1,H2A1,H3A1,H4A1,H1A3,H2A3,H3A3,H4A3,
     3               H1A11,H2A11,H3A11,H1A33,H2A33,H3A33,
     4               H1A13,H2A13,H3A13,
     5               H1A111,H2A111,H1A333,H2A333,
     6               H1A113,H2A113,H1A133,H2A133,
     7               HA1111,HA3333,HA1113,
     8               HA1333,HA1133
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMINS1 , VMINS2 , ZTRIAL(2) , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/ NSURF,  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ , NFINTA
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      include 'rensys.h'
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
C
      XROVAL = DFLOAT(NP1ROW-1)
      XCOVAL = DFLOAT(NP1COL-1)
C
      XKVAL = DFLOAT(KP1-1)
      XMVAL = -XKVAL
      FACTK=FACTJ*((-1.0D+00)**(KP1-1))
     1           *THREEJ(XROVAL, 1.0D+00, XCOVAL,
     1                   XMVAL , 0.0D+00, XKVAL )
C
      IF (NELEC .EQ. 2) THEN
                 MAXV21=V2MP12
                 MAXV22=V2MP11
      ELSE
                 MAXV21=V2MP11
                 MAXV22=V2MP12
      ENDIF
C
      DO 920 INDEX1=1,MAXV21
      DO 900 INDEX2=1,MAXV22
C
      KNDSYM=KNDSYM+1
      IOFSY=(KNDSYM-1)*NZERSY
      IF (.NOT. SYMM) THEN
           KNDASY=KNDASY+1
           IOFAS=(KNDASY-1)*NZERAS
      ENDIF
      IF (MOD(NP1ROW-1+ITAURO,2) .NE. 0  .AND. KP1 .EQ. 1)  GOTO 900
      IF (MOD(NP1COL-1+ITAUCO,2) .NE. 0  .AND. KP1 .EQ. 1)  GOTO 900
C
      KNDEX=0
C
      IF (NELEC .EQ. 2) THEN
         IROWOF=NOFSRO+                    (INDEX2-1)*NDIMRO
         ICOLOF=NOFSCO+                    (INDEX1-1)*NDIMCO
      ELSE
         IROWOF=NOFSRO+                    (INDEX1-1)*NDIMRO
         ICOLOF=NOFSCO+                    (INDEX2-1)*NDIMCO
      ENDIF
C
C  1. LEADING TERM (NOT DEPENDING ON STRETCHING COORDINATES)
C
      G =  FACTK*VALSYM(IOFSY+1)
      IF (NELEC .EQ. 2) THEN
          KNDEX=KNDEX+1
          DO 102 JL=1,NDIMCO
          DO 102 IR=1,NDIMRO
102       HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                          +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSEIF (NELEC .EQ. 1) THEN
          KNDEX=KNDEX+1
          DO 100 JL=1,NDIMCO
          DO 100 IR=1,NDIMRO
100       HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                          +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ELSE
          DO 101 IR=1,NDIMRO
101       HMAT(IROWOF+IR,ICOLOF+IR)=HMAT(IROWOF+IR,ICOLOF+IR)+G
      ENDIF
C
C  2. TERMS CONTAINING Y1
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+2)
      IF (NELEC .EQ. 2) THEN
      DO 122 JL=1,NDIMCO
      DO 122 IR=1,NDIMRO
122   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 120 JL=1,NDIMCO
      DO 120 IR=1,NDIMRO
120   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 3. TERMS CONTAINING Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G =  FACTK*VALASY(IOFAS+ 1)
      IF (NELEC .EQ. 2) THEN
      DO 142 JL=1,NDIMCO
      DO 142 IR=1,NDIMRO
142   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 140 JL=1,NDIMCO
      DO 140 IR=1,NDIMRO
140   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C  4. TERMS CONTAINING Y1*Y1
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+3)
      IF (NELEC .EQ. 2) THEN
      DO 162 JL=1,NDIMCO
      DO 162 IR=1,NDIMRO
162   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 160 JL=1,NDIMCO
      DO 160 IR=1,NDIMRO
160   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 5. TERMS CONTAINING Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G =  FACTK*VALASY(IOFAS+ 2)
      IF (NELEC .EQ. 2) THEN
      DO 182 JL=1,NDIMCO
      DO 182 IR=1,NDIMRO
182   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 180 JL=1,NDIMCO
      DO 180 IR=1,NDIMRO
180   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 6. TERMS CONTAINING Y1*Y3
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+4)
      IF (NELEC .EQ. 2) THEN
      DO 202 JL=1,NDIMCO
      DO 202 IR=1,NDIMRO
202   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 200 JL=1,NDIMCO
      DO 200 IR=1,NDIMRO
200   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C  7. TERMS CONTAINING Y1*Y1*Y1
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+5)
      IF (NELEC .EQ. 2) THEN
      DO 222 JL=1,NDIMCO
      DO 222 IR=1,NDIMRO
222   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 220 JL=1,NDIMCO
      DO 220 IR=1,NDIMRO
220   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 8. TERMS CONTAINING Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G =  FACTK*VALASY(IOFAS+ 3)
      IF (NELEC .EQ. 2) THEN
      DO 242 JL=1,NDIMCO
      DO 242 IR=1,NDIMRO
242   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 240 JL=1,NDIMCO
      DO 240 IR=1,NDIMRO
240   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C  9. TERMS CONTAINING Y1*Y1*Y3
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+6)
      IF (NELEC .EQ. 2) THEN
      DO 262 JL=1,NDIMCO
      DO 262 IR=1,NDIMRO
262   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 260 JL=1,NDIMCO
      DO 260 IR=1,NDIMRO
260   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 10. TERMS CONTAINING Y1*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G =  FACTK*VALASY(IOFAS+ 4)
      IF (NELEC .EQ. 2) THEN
      DO 282 JL=1,NDIMCO
      DO 282 IR=1,NDIMRO
282   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 280 JL=1,NDIMCO
      DO 280 IR=1,NDIMRO
280   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C  11. TERMS CONTAINING Y1*Y1*Y1*Y1
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+7)
      IF (NELEC .EQ. 2) THEN
      DO 302 JL=1,NDIMCO
      DO 302 IR=1,NDIMRO
302   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 300 JL=1,NDIMCO
      DO 300 IR=1,NDIMRO
300   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 12. TERMS CONTAINING Y3*Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G =  FACTK*VALASY(IOFAS+ 5)
      IF (NELEC .EQ. 2) THEN
      DO 322 JL=1,NDIMCO
      DO 322 IR=1,NDIMRO
322   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 320 JL=1,NDIMCO
      DO 320 IR=1,NDIMRO
320   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C  13. TERMS CONTAINING Y1*Y1*Y1*Y3
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+8)
      IF (NELEC .EQ. 2) THEN
      DO 342 JL=1,NDIMCO
      DO 342 IR=1,NDIMRO
342   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 340 JL=1,NDIMCO
      DO 340 IR=1,NDIMRO
340   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 14. TERMS CONTAINING Y1*Y3*Y3*Y3
C
      KNDEX=KNDEX+1
      IF (.NOT. SYMM) G =  FACTK*VALASY(IOFAS+ 6)
      IF (NELEC .EQ. 2) THEN
      DO 362 JL=1,NDIMCO
      DO 362 IR=1,NDIMRO
362   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 360 JL=1,NDIMCO
      DO 360 IR=1,NDIMRO
360   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
C 15. TERMS CONTAINING Y1*Y1*Y3*Y3
C
      KNDEX=KNDEX+1
      G =  FACTK*VALSYM(IOFSY+9)
      IF (NELEC .EQ. 2) THEN
      DO 382 JL=1,NDIMCO
      DO 382 IR=1,NDIMRO
382   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                  +G*SMAT(JSTOFF+JL,ISTOFF+IR,KNDEX)
      ELSE
      DO 380 JL=1,NDIMCO
      DO 380 IR=1,NDIMRO
380   HMAT(IROWOF+IR,ICOLOF+JL)=HMAT(IROWOF+IR,ICOLOF+JL)
     1                 +G*SMAT(ISTOFF+IR,JSTOFF+JL,KNDEX)
      ENDIF
C
900   CONTINUE
920   CONTINUE
940   CONTINUE
      RETURN
      END
C
      DOUBLE PRECISION FUNCTION THREEJ(A,B,C,AL,BE,GA)
C
C     CALCULATES WIGNER 3-J SYMBOLS USING FORMULA OF P34 OF BRINK &
C     SATCHLER IN "ANGULAR MOMENTUM"
C     NOTE FAKT(A)=FACT(A)/10**A
C     A=J1,B=J2,C=J,AL=M1,BE=M2,GA=-M
C
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      THREEJ=0.D0
C
C     (J1+J2).GE.J AND J.GE.ABS(A-B)    -M=M1+M2    J1,J2,J.GE.0
C     ABS(M1).LE.J1    ABS(M2).LE.J2   ABS(M).LE.J
C
      IF(C.GT.A+B)RETURN
      IF(C.LT.DABS(A-B))RETURN
      IF(A.LT.0.D0.OR.B.LT.0.D0.OR.C.LT.0.D0)RETURN
      IF(A.LT.DABS(AL).OR.B.LT.DABS(BE).OR.C.LT.DABS(GA))RETURN
      IF(-1.D0*GA.NE.AL+BE)RETURN
C
C
C     COMPUTE DELTA(ABC)
C
      DELTA=DSQRT(FAKT(A+B-C)*FAKT(A+C-B)*FAKT(B+C-A)/FAKT(A+B+C+1.D0))
C
C
      TERM1=FAKT(A+AL)*FAKT(A-AL)
      TERM2=FAKT(B-BE)*FAKT(B+BE)
      TERM3=FAKT(C+GA)*FAKT(C-GA)
      TERM=DSQRT((2.D0*C+1.D0)*TERM1*TERM2*TERM3)
C
C
C     NOW COMPUTE SUMMATION TERM
C
C     SUM TO GET SUMMATION IN EQ(2.34) OF BRINK AND SATCHLER.  SUM UNTIL
C     A TERM INSIDE FACTORIAL GOES NEGATIVE.  NEW IS INDEX FOR SUMMATION
C     .  NOW FIND WHAT THE RANGE OF NEW IS.
C
C
      NEWMIN=IDNINT(DMAX1((A+BE-C),(B-C-AL),0.D0))
      NEWMAX=IDNINT(DMIN1((A-AL),(B+BE),(A+B-C)))
C
C
      SUMM=0.D0
C
C
             DO 10 NEW=NEWMIN,NEWMAX
             DNEW=DFLOAT(NEW)
             TERM4=FAKT(A-AL-DNEW)*FAKT(C-B+AL+DNEW)
             TERM5=FAKT(B+BE-DNEW)*FAKT(C-A-BE+DNEW)
             TERM6=FAKT(DNEW)*FAKT(A+B-C-DNEW)
             SUMM=SUMM+(-1.D0)**NEW/(TERM4*TERM5*TERM6)
10           CONTINUE
C
C     SO CLEBSCH-GORDON <J1J2M1M2LJM> IS CLEBSH
C
      CLEBSH=DELTA*TERM*SUMM/DSQRT(10.D0)
C
C     CONVERT CLEBSCH-GORDON TO THREEJ
C
      IPHASE=IDNINT(A-B-GA)
      THREEJ=(-1.D0)**(IPHASE)*CLEBSH/DSQRT(2.D0*C+1.D0)
C
C
      RETURN
      END
C
C
      FUNCTION FAKT(A)
C     THIS FUNCTION COMPUTES N!/(10**N).  STOP 101 IMPLIES TRIED
C     TO TAKE FACTORIAL OF A NEGATIVE NO.
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      INTEGER PRTINT
      include 'rensys.h'
C
      AX=A
      FAKT=1.D0
      IF(AX.EQ.0.D0)RETURN
      FAKT=.1D0
      IF(AX.LT.0.D0) GOTO 9000
C
      IC=IDNINT(AX)
      AX=AX/10.D0
      FAKT=AX
             DO 10  I=1,IC-1
             FAKT=FAKT*(AX-DFLOAT(I)*.1D0)
10           CONTINUE
      RETURN
9000  WRITE (NFIL6,9014) AX
9014  FORMAT(1H0,' RENNER.FKT.ERR  NEGATIVE ARGUMENT FOR FUNCTI',
     1      'ON FAKT. ARGUMENT = ',E12.5)
      STOP
      END
C
C
      DOUBLE PRECISION FUNCTION SIXJ(X1,X2,X3,X4,X5,X6)
C
C     ROUTINE CALCULATES  6J SYMBOLS {X1 X2 X3}
C                                    {X4 X5 X6}
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z), INTEGER(I-N)
C
      SIXJ=0.D0
C
      AA1=(-X1+X2+X3)*(X1-X2+X3)*(X1+X2-X3)
      IF (AA1.LT.0.D0) GO TO 1000
      AA2=(-X1+X5+X6)*(X1-X5+X6)*(X1+X5-X6)
      IF (AA2.LT.0.D0) GO TO 1000
      AA3=(-X4+X2+X6)*(X4-X2+X6)*(X4+X2-X6)
      IF (AA3.LT.0.D0) GO TO 1000
      AA4=(-X4+X5+X3)*(X4-X5+X3)*(X4+X5-X3)
      IF (AA4.LT.0.D0) GO TO 1000
C
C
      I1=IDINT((X1+X2+X3))
      FRAC=X1+X2+X3-DFLOAT(I1)
      IF (DABS(FRAC).GT.1.D-9) GO TO 900
      I2=IDINT((X1+X5+X6))
      FRAC=X1+X5+X6-DFLOAT(I2)
      IF (DABS(FRAC).GT.1.D-9) GO TO 900
      I3=IDINT((X4+X2+X6))
      FRAC=X4+X2+X6-DFLOAT(I3)
      IF (DABS(FRAC).GT.1.D-9) GO TO 900
      I4=IDINT((X4+X5+X3))
      FRAC=X4+X5+X3-DFLOAT(I4)
      IF (DABS(FRAC).GT.1.D-9) GO TO 900
C
      K1=IDINT((X2+X3+X5+X6))
      K2=IDINT((X1+X3+X4+X6))
      K3=IDINT((X1+X2+X4+X5))
C
      KMIN=MAX0(I1,I2,I3,I4)
      KMAX=MIN0(K1,K2,K3)
C
      IF (KMIN.GT.KMAX) GO TO 1000
C
      I2X1=IDINT((2.D0*X1+0.1D0))
      I2X2=IDINT((2.D0*X2+0.1D0))
      I2X3=IDINT((2.D0*X3+0.1D0))
      I2X4=IDINT((2.D0*X4+0.1D0))
      I2X5=IDINT((2.D0*X5+0.1D0))
      I2X6=IDINT((2.D0*X6+0.1D0))
C
C
      EXPON=0.5D0*(FACLOG(I1-I2X1)+FACLOG(I1-I2X2)+FACLOG(I1-I2X3)
     +    +FACLOG(I2-I2X1)+FACLOG(I2-I2X5)+FACLOG(I2-I2X6)
     +    +FACLOG(I3-I2X4)+FACLOG(I3-I2X2)+FACLOG(I3-I2X6)
     +    +FACLOG(I4-I2X4)+FACLOG(I4-I2X5)+FACLOG(I4-I2X3)
     +    -FACLOG(I1+1)-FACLOG(I2+1)-FACLOG(I3+1)-FACLOG(I4+1))
     +    +FACLOG(KMIN+1)
     +    -FACLOG(KMIN-I1)-FACLOG(KMIN-I2)-FACLOG(KMIN-I3)
     +    -FACLOG(KMIN-I4)
     +    -FACLOG(K1-KMIN)-FACLOG(K2-KMIN)-FACLOG(K3-KMIN)
      TERM=DFLOAT((-1)**KMIN)*DEXP(EXPON)
C
C
      SIXJ=TERM
C
      IF (KMAX.EQ.KMIN) GO TO 1000
C
      SUM=1.D0
      TERM=1.D0
      DO 200 K=(KMIN+1),KMAX
      XK=DFLOAT((K+1)*(K1-K+1)*(K2-K+1)*(K3-K+1))
      YK=DFLOAT((K-I1)*(K-I2)*(K-I3)*(K-I4))
      TERM=-TERM*XK/YK
      SUM=SUM+TERM
  200 CONTINUE
C
      SIXJ=SIXJ*SUM
1000  RETURN
C
  900 WRITE(6,6111)
 6111 FORMAT(1H0,' RENNER.SXJ.ERR   SUM OF J VALUES IN A TRIANGLE ',
     1 'OF 6J NON-INTEGRAL ')
      WRITE(6,6112) X1,X2,X3,X4,X5,X6
 6112 FORMAT(1H0,'                  J VALUES:', 6F10.3)
C
      STOP
      END
